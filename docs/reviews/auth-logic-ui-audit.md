# ç™»å½•æ³¨å†Œ + ç¤¾äº¤ + UIä¸€è‡´æ€§ + è§„èŒƒæ€§å®¡æŸ¥

**å®¡æŸ¥æ—¥æœŸ:** 2026-02-23 20:52  
**å®¡æŸ¥äºº:** è›‹è›‹ğŸ¥š

---

## ä¸€ã€è®¤è¯é€»è¾‘å®¡æŸ¥

### ğŸ”´ Critical Bug: æ³¨å†Œä¸è¿”å›Token

**åç«¯ `POST /auth/register`:**
```python
def register(req):
    ...
    return _user_response(row)  # åªè¿”å› UserResponseï¼ˆid, email, username...ï¼‰
```

**å‰ç«¯ `registerAPI` æœŸæœ›ï¼š**
```typescript
apiFetch<{ access_token: string; user: {...} }>("/auth/register", ...)
```

**é—®é¢˜ï¼šæ³¨å†ŒæˆåŠŸååç«¯åªè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è¿”å›tokenã€‚å‰ç«¯å°è¯•è¯»å– `res.access_token` ä¼šæ˜¯ undefinedï¼Œå¯¼è‡´ï¼š**
1. æ³¨å†ŒæˆåŠŸä½†ä¸è‡ªåŠ¨ç™»å½•
2. Zustand storeå­˜å…¥null token
3. åç»­æ‰€æœ‰éœ€è¦è®¤è¯çš„APIè°ƒç”¨å¤±è´¥

**ä¿®å¤ï¼š** åç«¯æ³¨å†ŒæˆåŠŸååº”è¯¥åŒæ—¶è¿”å›tokenï¼ˆåƒloginä¸€æ ·ï¼‰ã€‚

### ğŸ”´ Critical Bug: å‰ç«¯loginå‘é€å­—æ®µä¸åŒ¹é…

**å‰ç«¯ loginAPIï¼š**
```typescript
body: JSON.stringify({ email, password })
```
ä½†loginè¡¨å•çš„å­—æ®µæ ‡ç­¾æ˜¯"Email"ï¼Œç”¨æˆ·å¯èƒ½è¾“å…¥usernameã€‚

**åç«¯ UserLoginRequest æ”¯æŒ email æˆ– usernameï¼š**
```python
class UserLoginRequest:
    email: Optional[str] = None
    username: Optional[str] = None
    password: str
```

**é—®é¢˜ï¼š** å‰ç«¯å§‹ç»ˆå‘ `{email: value, password: value}`ã€‚å¦‚æœç”¨æˆ·è¾“å…¥usernameï¼Œåç«¯ä¼šç”¨usernameå­—æ®µçš„å€¼å»æŸ¥emailè¡¨ï¼ŒæŸ¥ä¸åˆ°å°±æŠ¥é”™ã€‚ç”¨æˆ·ä¼šå›°æƒ‘ä¸ºä»€ä¹ˆç”¨usernameç™»å½•ä¸äº†ã€‚

**ä¿®å¤ï¼š** å‰ç«¯åº”åˆ¤æ–­è¾“å…¥æ˜¯å¦åŒ…å«@æ¥å†³å®šå‘emailè¿˜æ˜¯usernameå­—æ®µã€‚

### âš ï¸ ç™»å½•æˆåŠŸåæ— ç”¨æˆ·ä¿¡æ¯è¿”å›

**åç«¯loginè¿”å›ï¼š** `TokenResponse { access_token, refresh_token, token_type }`  
**å‰ç«¯æœŸæœ›ï¼š** `{ access_token, user: { id, username, email, role } }`

**é—®é¢˜ï¼š** åç«¯loginåªè¿”å›tokenä¸è¿”å›userä¿¡æ¯ã€‚å‰ç«¯ `loginAPI` è§£æ„ `res.user` ä¼šæ˜¯undefinedã€‚

**ä¿®å¤ï¼š** åç«¯loginä¹Ÿåº”è¿”å›userä¿¡æ¯ï¼Œæˆ–å‰ç«¯loginåå†è°ƒGET /auth/meã€‚

### âš ï¸ Refresh Tokenæœªä½¿ç”¨

åç«¯æœ‰refresh tokenæœºåˆ¶ï¼Œå‰ç«¯å®Œå…¨æ²¡æœ‰ä½¿ç”¨refresh_tokenï¼š
- ä¸å­˜å‚¨refresh_token
- ä¸å®ç°è‡ªåŠ¨åˆ·æ–°
- Tokenè¿‡æœŸåç›´æ¥è¸¢åˆ°ç™»å½•é¡µ

---

## äºŒã€è¯­è¨€ä¸€è‡´æ€§å®¡æŸ¥ â€” ä¸­è‹±æ··æ‚

| ä½ç½® | å†…å®¹ | é—®é¢˜ |
|------|------|------|
| æ³¨å†Œé¡µæ ‡é¢˜ | "Create Account" | è‹±æ–‡ âœ… |
| æ³¨å†Œé¡µå‰¯æ ‡é¢˜ | "åŠ å…¥ RealWorldClaw ç¤¾åŒº" | ä¸­æ–‡ âŒ |
| æ³¨å†Œé¡µplaceholder | "è‡³å°‘ 8 ä½" | ä¸­æ–‡ âŒ |
| æ³¨å†Œé¡µæŒ‰é’® | "æ³¨å†Œ" | ä¸­æ–‡ âŒ |
| æ³¨å†Œé¡µé“¾æ¥ | "ç™»å½•" | ä¸­æ–‡ âŒ |
| æ³¨å†Œé¡µé”™è¯¯ | "Registration failedï¼Œè¯·ç¨åé‡è¯•" | ä¸­è‹±æ··æ‚ âŒ |
| ç™»å½•é¡µæ ‡é¢˜ | "Sign in to RealWorldClaw" | è‹±æ–‡ âœ… |
| ç™»å½•é¡µæŒ‰é’® | "Sign In" | è‹±æ–‡ âœ… |
| ç™»å½•é¡µé“¾æ¥ | "Sign Up" | è‹±æ–‡ âœ… |

**ç»“è®ºï¼šç™»å½•é¡µå…¨è‹±æ–‡ï¼Œæ³¨å†Œé¡µä¸­è‹±æ··æ‚ã€‚åŒä¸€ä¸ªäº§å“ä¸¤ç§è¯­è¨€é£æ ¼ï¼Œä¸ä¸“ä¸šã€‚**

**ä¿®å¤ï¼š** ç»Ÿä¸€ä¸ºè‹±æ–‡ï¼ˆé¢å‘å…¨çƒå¸‚åœºï¼‰ï¼Œæˆ–ç»Ÿä¸€ä¸ºä¸­æ–‡ï¼ˆå¦‚æœç›®æ ‡ç”¨æˆ·æ˜¯å›½å†…ï¼‰ã€‚å»ºè®®ç»Ÿä¸€è‹±æ–‡ã€‚

---

## ä¸‰ã€UIä¸€è‡´æ€§å®¡æŸ¥

### ç™»å½• vs æ³¨å†Œé¡µå¯¹æ¯”

| å…ƒç´  | ç™»å½•é¡µ | æ³¨å†Œé¡µ | ä¸€è‡´ï¼Ÿ |
|------|--------|--------|--------|
| å›¾æ ‡ | ğŸŒ | ğŸ”§ | âŒ ä¸åŒ |
| æ ‡é¢˜é£æ ¼ | "Sign in to RealWorldClaw" | "Create Account" | âŒ é£æ ¼ä¸åŒ |
| å‰¯æ ‡é¢˜ | è‹±æ–‡ | ä¸­æ–‡ | âŒ |
| æŒ‰é’®æ–‡å­— | "Sign In" | "æ³¨å†Œ" | âŒ è¯­è¨€ä¸åŒ |
| åº•éƒ¨é“¾æ¥ | "Don't have an account? Sign Up" | "Already have an account? ç™»å½•" | âŒ æ··æ‚ |
| åŠ¨ç”» | spring motion | spring motion | âœ… |
| Cardæ ·å¼ | border-border/50 | border-border/50 | âœ… |
| å®½åº¦ | max-w-sm | max-w-sm | âœ… |

### å…¨ç«™èƒŒæ™¯è‰²å®¡æŸ¥

| é¡µé¢ | èƒŒæ™¯ | ä¸€è‡´ï¼Ÿ |
|------|------|--------|
| é¦–é¡µ | bg-[#0a0a0f] (è‡ªå®šä¹‰æ·±è‰²) | âš ï¸ |
| ç¤¾åŒº | bg-background (CSSå˜é‡) | âœ… |
| åœ°å›¾ | bg-slate-950 | âš ï¸ |
| è®¢å• | bg-slate-950 | âš ï¸ |
| ç™»å½•/æ³¨å†Œ | bg-background | âœ… |
| Dashboard | æ— (ç»§æ‰¿body) | âœ… |
| Settings | bg-slate-950 | âš ï¸ |

**é—®é¢˜ï¼š** ä¸‰ç§æ·±è‰²èƒŒæ™¯æ··ç”¨ â€” `bg-[#0a0a0f]`, `bg-slate-950`, `bg-background`(CSSå˜é‡=240 6% 3%)ã€‚è§†è§‰ä¸Šå·®å¼‚å°ä½†ä¸è§„èŒƒã€‚

### Header vs é¡µé¢å†…å®¹

Headerç”¨ `bg-slate-950/80 backdrop-blur-md`ï¼Œä¸æ‰€æœ‰é¡µé¢èƒŒæ™¯æ­é…OKã€‚âœ…

---

## å››ã€ç¤¾äº¤åŠŸèƒ½å®¡æŸ¥

### ç¤¾åŒºå¸–å­ (/community)
- âœ… å¸–å­åˆ—è¡¨ã€ç­›é€‰ã€åˆ†é¡µ
- âœ… å¸–å­è¯¦æƒ…ã€è¯„è®º
- âœ… æŠ•ç¥¨åŠŸèƒ½
- âš ï¸ å‘å¸–(/community/new)æ²¡æœ‰è®¤è¯æ£€æŸ¥çš„å‰ç«¯æç¤º
- âš ï¸ å¸–å­ç±»å‹ç­›é€‰ä¸­æœ‰"task"ç±»å‹tagç”¨äº†orangeè‰²ï¼Œä¸å“ç‰Œè‰²ä¸ä¸€è‡´

### ç”¨æˆ·Profile (/profile/[id])
- âœ… ç”¨æˆ·ä¿¡æ¯å±•ç¤º
- âŒ æ— errorå¤„ç†ï¼ˆæš–ç¾Šç¾Šæ­£åœ¨ä¿®ï¼‰
- âš ï¸ æ— ç¼–è¾‘profileåŠŸèƒ½

### Spaces (/spaces)
- âš ï¸ åŠŸèƒ½ä¸æ˜ç¡®â€”â€”æ˜¯å­ç¤¾åŒºè¿˜æ˜¯é¢‘é“ï¼Ÿ
- âŒ æ— errorå¤„ç†ï¼ˆæš–ç¾Šç¾Šæ­£åœ¨ä¿®ï¼‰

---

## äº”ã€è¡¨å•è§„èŒƒæ€§å®¡æŸ¥

### æ³¨å†Œè¡¨å•
| å­—æ®µ | å‰ç«¯éªŒè¯ | åç«¯éªŒè¯ | é—®é¢˜ |
|------|---------|---------|------|
| username | required | min3, max32 | âŒ å‰ç«¯æ— min/max |
| email | type=email, required | @å’Œ.æ£€æŸ¥ | âœ… |
| password | required, minLength=8 | min8 | âœ… |

### ç™»å½•è¡¨å•
| å­—æ®µ | å‰ç«¯éªŒè¯ | åç«¯éªŒè¯ | é—®é¢˜ |
|------|---------|---------|------|
| email | type=email, required | optional | âš ï¸ labelè¯´Emailä½†åç«¯ä¹Ÿæ¥å—username |
| password | required | required | âœ… |

### è®¢å•è¡¨å• (/orders/new)
| å­—æ®µ | å‰ç«¯ | åç«¯å¿…å¡« | é—®é¢˜ |
|------|------|---------|------|
| delivery_province | ? | âœ… | âš ï¸ éœ€è¦éªŒè¯å‰ç«¯æ˜¯å¦æ”¶é›† |
| delivery_city | ? | âœ… | âš ï¸ |
| delivery_district | ? | âœ… | âš ï¸ |
| delivery_address | ? | âœ… min5 | âš ï¸ |

---

## å…­ã€ä¿®å¤ä¼˜å…ˆçº§

### ç«‹å³ä¿®ï¼ˆé˜»å¡æ ¸å¿ƒæµç¨‹ï¼‰
1. ğŸ”´ **æ³¨å†Œä¸è¿”å›token** â€” åç«¯registeråº”è¿”å›TokenResponse+user
2. ğŸ”´ **ç™»å½•æ— userä¿¡æ¯** â€” åç«¯loginåº”è¿”å›useræˆ–å‰ç«¯ç™»å½•åè°ƒ/me
3. ğŸ”´ **æ³¨å†Œé¡µä¸­è‹±æ··æ‚** â€” ç»Ÿä¸€è‹±æ–‡

### æœ¬å‘¨ä¿®
4. âš ï¸ ç™»å½•æ”¯æŒusernameï¼ˆå‰ç«¯åˆ¤æ–­@ï¼‰
5. âš ï¸ èƒŒæ™¯è‰²ç»Ÿä¸€ä¸ºCSSå˜é‡
6. âš ï¸ æ³¨å†Œ/ç™»å½•å›¾æ ‡ç»Ÿä¸€
7. âš ï¸ æ³¨å†ŒusernameåŠ å‰ç«¯min/maxéªŒè¯

### åç»­
8. Refresh tokenæœºåˆ¶å®ç°
9. Profileç¼–è¾‘åŠŸèƒ½
10. SpacesåŠŸèƒ½å®šä¹‰æ¸…æ™°åŒ–

---

*è›‹è›‹ğŸ¥š | 2026-02-23*
