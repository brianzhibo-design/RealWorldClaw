# 深层审查（六）：修复后复查

**日期:** 2026-02-24 04:15  
**对比基准:** 审查四(52问题) + 审查五(12盲区)  

---

## 📊 评分卡（20维度）

| # | 维度 | 上次 | 现在 | 变化 | 说明 |
|---|------|------|------|------|------|
| 1 | API端点测试 | 5 | 6 | +1 | 77端点可用，/orders创建返回异常需查 |
| 2 | 前后端契约 | 3 | **7** | +4 | Order/Post已对齐，profile页仍有2处旧字段 |
| 3 | 用户旅程 | 4 | **7** | +3 | 注册→登录→发帖→估价全通，创建订单需查 |
| 4 | 数据完整性 | 5 | **7** | +2 | 42个索引，外键ON，3个孤儿maker未清 |
| 5 | 认证安全 | 4 | **8** | +4 | Rate limit✅ 暴力延迟✅ 密码8位✅ 无邮箱验证 |
| 6 | 授权安全 | 6 | **8** | +2 | 19处身份验证 + BEGIN IMMEDIATE竞态锁 |
| 7 | 输入安全 | 4 | **7** | +3 | XSS sanitize✅ 但12处f-string SQL仍在 |
| 8 | 前端代码质量 | 4 | **7** | +3 | fetch统一✅ localStorage统一✅ 16处any残留 |
| 9 | 后端代码质量 | 4 | **6** | +2 | logger已初始化但仅4条业务日志，14处except Exception |
| 10 | 死代码 | 3 | **7** | +4 | EmptyState 16处引用✅ ErrorState 0处❌ |
| 11 | 移动端适配 | 7 | 7 | 0 | 未变 |
| 12 | 可访问性 | 3 | **5** | +2 | slate-500基本清零，82按钮仍缺aria-label |
| 13 | 错误/空状态 | 1 | **8** | +7 | 404✅ error✅ loading✅ EmptyState×16✅ |
| 14 | 合规性 | 0 | **6** | +6 | 隐私✅ 条款✅ checkbox✅ 无Cookie声明/数据删除 |
| 15 | SEO | 2 | **7** | +5 | 12页title✅ OG✅ sitemap×13✅ favicon✅ manifest✅ |
| 16 | Landing说服力 | 4 | **6** | +2 | How it works✅ Footer✅ 无社会证明/视频 |
| 17 | 性能 | 4 | 4 | 0 | ~1s未变（地理延迟） |
| 18 | 基础设施 | 4 | **6** | +2 | 备份✅ CI✅ 42索引✅ 无监控实例/staging |
| 19 | 开源准备度 | 7 | **9** | +2 | 全套：LICENSE/CONTRIBUTING/COC/SECURITY/CHANGELOG/5templates/4actions |
| 20 | 国际化 | 2 | **4** | +2 | messages.ts✅ 后端英文化✅ 无i18n框架 |

---

## 📈 总分对比

| 指标 | 上次 | 现在 |
|------|------|------|
| **加权平均** | **4.5/10** | **6.6/10** |
| 问题总数 | 52 | 23 |
| P0问题(安全/法律) | 9 | **2** |
| ✅通过维度(≥7) | 1 | **12** |
| ❌不及格维度(<5) | 8 | **3** |

**提升幅度: +2.1分 (+47%)**

---

## 🔴 剩余问题清单（23个）

### 高优先级（仍影响使用）
| # | 问题 | 维度 |
|---|------|------|
| 1 | 邮箱验证仍缺 — 注册即激活 | 安全 |
| 2 | 12处f-string SQL — 模式脆弱 | 安全 |
| 3 | /orders创建可能返回异常（复查中发现） | 功能 |
| 4 | profile页2处旧字段(order.title, status=shipped) | 契约 |
| 5 | ErrorState组件0处引用 | 质量 |
| 6 | Cookie声明缺失 | 合规 |
| 7 | 用户数据删除功能缺失(GDPR) | 合规 |

### 中优先级（影响专业度）
| # | 问题 | 维度 |
|---|------|------|
| 8 | 82个button缺aria-label | a11y |
| 9 | 16处TypeScript any | 质量 |
| 10 | 14处except Exception宽泛捕获 | 质量 |
| 11 | 仅4条业务日志（已init但未广泛使用）| 质量 |
| 12 | 2处text-slate-500残留 | a11y |
| 13 | 3个孤儿maker未清理 | 数据 |
| 14 | API ~1s响应（地理延迟） | 性能 |

### 低优先级（锦上添花）
| # | 问题 | 维度 |
|---|------|------|
| 15 | 无社会证明(testimonials) | Landing |
| 16 | 无Demo视频 | Landing |
| 17 | 无i18n框架 | 国际化 |
| 18 | 无staging环境 | 基础设施 |
| 19 | 无监控实例(UptimeRobot未注册) | 基础设施 |
| 20 | 无结构化数据(JSON-LD) | SEO |
| 21 | 无PWA图标(icon-192/512.png) | PWA |
| 22 | 后端注释大量中文 | 国际化 |
| 23 | 帖子/评论无频率限制 | 安全 |

---

## 🏆 Top 5 优先修复

1. **profile页旧字段** — 2分钟修复，order.title→order_number, shipped→shipping
2. **ErrorState接入** — 所有列表页的catch都该用ErrorState
3. **邮箱验证** — 至少发验证链接（可用Resend）
4. **/orders创建调试** — 检查为什么audit测试返回异常
5. **帖子频率限制** — 复用现有_rate_check框架

---

*蛋蛋🥚 | 2026-02-24 04:20 | 评分 4.5→6.6 (+47%)*
